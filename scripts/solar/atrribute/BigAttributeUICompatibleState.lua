local ____lualib = require("lualib_bundle")
local __TS__Class = ____lualib.__TS__Class
local __TS__New = ____lualib.__TS__New
local __TS__SourceMapTraceBack = ____lualib.__TS__SourceMapTraceBack
__TS__SourceMapTraceBack(debug.getinfo(1).short_src, {["7"] = 1,["8"] = 1,["9"] = 2,["10"] = 2,["11"] = 3,["12"] = 3,["13"] = 4,["14"] = 4,["15"] = 5,["16"] = 5,["17"] = 6,["18"] = 6,["19"] = 7,["20"] = 7,["21"] = 8,["22"] = 8,["23"] = 9,["24"] = 9,["25"] = 10,["26"] = 10,["27"] = 11,["28"] = 11,["29"] = 13,["30"] = 14,["31"] = 15,["32"] = 15,["33"] = 15,["35"] = 44,["36"] = 45,["39"] = 48,["40"] = 48,["41"] = 48,["42"] = 49,["43"] = 50,["44"] = 52,["45"] = 53,["46"] = 54,["47"] = 48,["48"] = 48,["49"] = 43,["50"] = 59,["51"] = 60,["52"] = 60,["53"] = 60,["54"] = 60,["55"] = 60,["56"] = 60,["57"] = 60,["58"] = 61,["59"] = 61,["60"] = 61,["61"] = 61,["62"] = 61,["63"] = 61,["64"] = 61,["65"] = 64,["66"] = 65,["67"] = 66,["70"] = 69,["71"] = 70,["73"] = 72,["75"] = 76,["76"] = 77,["77"] = 78,["78"] = 79,["79"] = 80,["80"] = 81,["81"] = 82,["82"] = 83,["84"] = 85,["86"] = 87,["87"] = 89,["88"] = 90,["89"] = 91,["90"] = 92,["91"] = 93,["92"] = 94,["94"] = 97,["95"] = 98,["96"] = 99,["97"] = 100,["98"] = 102,["99"] = 103,["100"] = 104,["101"] = 105,["102"] = 106,["104"] = 108,["106"] = 110,["107"] = 110,["108"] = 110,["109"] = 110,["111"] = 114,["112"] = 115,["113"] = 116,["114"] = 117,["115"] = 118,["116"] = 119,["117"] = 120,["119"] = 122,["121"] = 124,["122"] = 124,["123"] = 124,["124"] = 124,["126"] = 128,["127"] = 129,["128"] = 130,["129"] = 131,["130"] = 132,["132"] = 134,["133"] = 136,["134"] = 137,["135"] = 138,["136"] = 139,["137"] = 140,["139"] = 143,["140"] = 145,["141"] = 146,["142"] = 147,["143"] = 148,["144"] = 149,["146"] = 151,["147"] = 59,["148"] = 158,["149"] = 169,["150"] = 170,["151"] = 171,["152"] = 178,["153"] = 179,["154"] = 180,["155"] = 182,["156"] = 183,["157"] = 184,["158"] = 186,["159"] = 188,["160"] = 189,["161"] = 191,["162"] = 193,["163"] = 194,["164"] = 196,["165"] = 197,["166"] = 198,["167"] = 198,["168"] = 198,["169"] = 198,["170"] = 198,["171"] = 198,["172"] = 198,["173"] = 198,["174"] = 201,["175"] = 203,["176"] = 203,["177"] = 203,["178"] = 203,["179"] = 203,["180"] = 203,["181"] = 203,["182"] = 203,["183"] = 205,["184"] = 207,["185"] = 208,["186"] = 208,["187"] = 208,["188"] = 208,["189"] = 208,["190"] = 208,["191"] = 208,["192"] = 208,["193"] = 210,["194"] = 215,["195"] = 216,["196"] = 217,["197"] = 218,["198"] = 220,["199"] = 221,["200"] = 222,["201"] = 223,["202"] = 225,["203"] = 226,["204"] = 227,["205"] = 229,["206"] = 230,["207"] = 231,["208"] = 158,["209"] = 240,["210"] = 244,["211"] = 245,["212"] = 245,["213"] = 245,["214"] = 245,["215"] = 245,["216"] = 245,["217"] = 245,["218"] = 245,["219"] = 246,["220"] = 247,["221"] = 247,["222"] = 247,["223"] = 247,["224"] = 247,["225"] = 247,["226"] = 247,["227"] = 247,["228"] = 254,["229"] = 255,["230"] = 255,["231"] = 255,["232"] = 255,["233"] = 255,["234"] = 255,["235"] = 255,["236"] = 255,["237"] = 257,["238"] = 258,["239"] = 258,["240"] = 258,["241"] = 258,["242"] = 258,["243"] = 258,["244"] = 258,["245"] = 258,["246"] = 260,["247"] = 261,["248"] = 261,["249"] = 261,["250"] = 261,["251"] = 261,["252"] = 261,["253"] = 261,["254"] = 261,["255"] = 265,["256"] = 266,["257"] = 266,["258"] = 266,["259"] = 266,["260"] = 266,["261"] = 266,["262"] = 266,["263"] = 266,["264"] = 269,["265"] = 270,["266"] = 270,["267"] = 270,["268"] = 270,["269"] = 270,["270"] = 270,["271"] = 270,["272"] = 270,["273"] = 272,["274"] = 273,["275"] = 273,["276"] = 273,["277"] = 273,["278"] = 273,["279"] = 273,["280"] = 273,["281"] = 273,["282"] = 275,["283"] = 276,["284"] = 276,["285"] = 276,["286"] = 276,["287"] = 276,["288"] = 276,["289"] = 276,["290"] = 276,["291"] = 278,["292"] = 279,["293"] = 279,["294"] = 279,["295"] = 279,["296"] = 279,["297"] = 279,["298"] = 281,["299"] = 282,["300"] = 282,["301"] = 282,["302"] = 282,["303"] = 282,["304"] = 282,["305"] = 284,["306"] = 285,["307"] = 285,["308"] = 285,["309"] = 285,["310"] = 285,["311"] = 285,["312"] = 287,["313"] = 288,["314"] = 288,["315"] = 288,["316"] = 288,["317"] = 288,["318"] = 288,["319"] = 240,["320"] = 291,["321"] = 291,["322"] = 291,["324"] = 292,["325"] = 293,["326"] = 294,["327"] = 295,["328"] = 296,["329"] = 297,["330"] = 298,["331"] = 291,["332"] = 16,["333"] = 15});
local ____exports = {}
local ____UnitUtil = require("solar.util.unit.UnitUtil")
local UnitUtil = ____UnitUtil.default
local ____NativeFrameUtil = require("solar.util.frame.NativeFrameUtil")
local NativeFrameUtil = ____NativeFrameUtil.default
local ____TextUtil = require("solar.util.text.TextUtil")
local TextUtil = ____TextUtil.default
local ____trigger = require("solar.w3ts.handles.trigger")
local Trigger = ____trigger.Trigger
local ____ColorStr = require("solar.constant.ColorStr")
local ColorStr = ____ColorStr.default
local ____frame = require("solar.w3ts.handles.frame")
local Frame = ____frame.Frame
local ____BaseUtil = require("solar.util.BaseUtil")
local BaseUtil = ____BaseUtil.default
local ____SelectUtil = require("solar.util.unit.SelectUtil")
local SelectUtil = ____SelectUtil.default
local ____HeroUtil = require("solar.util.unit.HeroUtil")
local HeroUtil = ____HeroUtil.default
local ____ExFrameApiUtil = require("solar.util.frame.ExFrameApiUtil")
local ExFrameApiUtil = ____ExFrameApiUtil.default
local ____SingletonUtil = require("solar.util.lang.SingletonUtil")
local SingletonUtil = ____SingletonUtil.default
local textFont = "Fonts\\dfst-m3u.ttf"
local textHeight = 0.01
____exports.default = __TS__Class()
local BigAttributeUICompatibleState = ____exports.default
BigAttributeUICompatibleState.name = "BigAttributeUICompatibleState"
function BigAttributeUICompatibleState.prototype.____constructor(self)
    if SingletonUtil:notFirstTime(____exports.default) then
        print("不能重复new BigAttributeUICompatibleState()")
        return
    end
    BaseUtil.runLater(
        0.1,
        function()
            self:moveNativeFrame()
            self:createUI()
            local trigger = __TS__New(Trigger)
            trigger:registerTimerEvent(0.1, true)
            trigger:addAction(self.refreshSolarUI)
        end
    )
end
function BigAttributeUICompatibleState.prototype.refreshSolarUI()
    DzFrameSetText(
        ____exports.default.goldFrame,
        TextUtil:toCnUnit(GetPlayerState(
            GetLocalPlayer(),
            PLAYER_STATE_RESOURCE_GOLD
        ))
    )
    DzFrameSetText(
        ____exports.default.lumberFrame,
        TextUtil:toCnUnit(GetPlayerState(
            GetLocalPlayer(),
            PLAYER_STATE_RESOURCE_LUMBER
        ))
    )
    local unit = SelectUtil.getRealSelectUnit()
    if not IsHandle(unit) then
        ____exports.default:showSolarUI(false)
        return
    end
    if HeroUtil:isHero(unit) then
        ____exports.default:showSolarUI(true, true)
    else
        ____exports.default:showSolarUI(true, false)
    end
    local life = GetUnitState(unit, UNIT_STATE_LIFE)
    local maxLife = GetUnitState(unit, UNIT_STATE_MAX_LIFE)
    local bfbLife = R2I(life * 100 / maxLife)
    local hpText = ((TextUtil:toCnUnit(life) .. "/") .. TextUtil:toCnUnit(maxLife)) .. ("(" .. tostring(bfbLife)) .. ")%"
    if bfbLife > 80 then
        hpText = ColorStr.green .. hpText
    elseif bfbLife > 40 then
        hpText = ColorStr.yellow .. hpText
    else
        hpText = ColorStr.red .. hpText
    end
    DzFrameSetText(____exports.default.hpFrame, hpText)
    local mana = GetUnitState(unit, UNIT_STATE_MANA)
    local maxMana = GetUnitState(unit, UNIT_STATE_MAX_MANA)
    if maxMana and maxMana > 0 then
        local bfbMana = tostring(R2I(mana * 100 / maxMana)) .. "%"
        local manaText = ((TextUtil:toCnUnit(mana) .. " / ") .. TextUtil:toCnUnit(maxMana)) .. ("(" .. bfbMana) .. ")"
        DzFrameSetText(____exports.default.manaFrame, manaText)
    end
    local aAttack = GetUnitState(unit, UnitStateDamageMix)
    if ____exports.default.config.isShowGreenAttack then
        local lvAttack = GetUnitState(unit, UnitStateDamageBonus)
        local bAttack = aAttack - lvAttack
        local blText = TextUtil:toCnUnit(bAttack)
        if lvAttack > 0 then
            blText = (((blText .. "  ") .. ColorStr.green) .. "+") .. TextUtil:toCnUnit(lvAttack)
        elseif lvAttack < -20 then
            blText = ((blText .. "  ") .. ColorStr.red) .. TextUtil:toCnUnit(lvAttack)
        end
        DzFrameSetText(____exports.default.attackValueFrame, blText)
    else
        DzFrameSetText(
            ____exports.default.attackValueFrame,
            TextUtil:toCnUnit(aAttack)
        )
    end
    if ____exports.default.config.isShowGreenArmor then
        local extraDef = UnitUtil.getExtraDef(unit)
        local armorText = TextUtil:toCnUnit(GetUnitState(unit, UnitStateArmor) - extraDef)
        if extraDef > 0 then
            armorText = (((armorText .. "  ") .. ColorStr.green) .. "+") .. TextUtil:toCnUnit(extraDef)
        elseif extraDef < 0 then
            armorText = ((armorText .. "  ") .. ColorStr.red) .. TextUtil:toCnUnit(extraDef)
        end
        DzFrameSetText(____exports.default.armorValueFrame, armorText)
    else
        DzFrameSetText(
            ____exports.default.armorValueFrame,
            TextUtil:toCnUnit(GetUnitState(unit, UnitStateArmor))
        )
    end
    local bStr = GetHeroStr(unit, false)
    local blStr = GetHeroStr(unit, true)
    local strText = TextUtil:toCnUnit(bStr)
    if bStr ~= blStr then
        strText = (((strText .. "  ") .. ColorStr.green) .. "+") .. TextUtil:toCnUnit(blStr - bStr)
    end
    DzFrameSetText(____exports.default.heroStrValueFrame, strText)
    local bAgi = GetHeroAgi(unit, false)
    local blAgi = GetHeroAgi(unit, true)
    local agiText = TextUtil:toCnUnit(bAgi)
    if bAgi ~= blAgi then
        agiText = (((agiText .. "  ") .. ColorStr.green) .. "+") .. TextUtil:toCnUnit(blAgi - bAgi)
    end
    DzFrameSetText(____exports.default.heroAgiValueFrame, agiText)
    local bInt = GetHeroInt(unit, false)
    local blInt = GetHeroInt(unit, true)
    local intText = TextUtil:toCnUnit(bInt)
    if bInt ~= blInt then
        intText = (((intText .. "  ") .. ColorStr.green) .. "+") .. TextUtil:toCnUnit(blInt - bInt)
    end
    DzFrameSetText(____exports.default.heroIntValueFrame, intText)
end
function BigAttributeUICompatibleState.prototype.createUI(self)
    ____exports.default.unitUIContainer = ExFrameApiUtil:createBaseFrameInSimpleFrame(NativeFrameUtil:getUnitStatePanel())
    ____exports.default.unitArmorContainer = ExFrameApiUtil:createBaseFrameInSimpleFrame(DzSimpleFrameFindByName("SimpleInfoPanelIconDamage", 2))
    ____exports.default.heroUIContainer = ExFrameApiUtil:createBaseFrameInSimpleFrame(NativeFrameUtil:getHeroStatePanel())
    ____exports.default.goldFrame = __TS__New(Frame, "TEXT").current
    DzFrameSetAbsolutePoint(____exports.default.goldFrame, FRAMEPOINT_TOPRIGHT, 0.533, 0.595)
    DzFrameSetFont(____exports.default.goldFrame, textFont, textHeight, 0)
    ____exports.default.lumberFrame = __TS__New(Frame, "TEXT").current
    DzFrameSetAbsolutePoint(____exports.default.lumberFrame, FRAMEPOINT_TOPRIGHT, 0.621, 0.595)
    DzFrameSetFont(____exports.default.lumberFrame, textFont, textHeight, 0)
    ____exports.default.attackValueFrame = __TS__New(Frame, "TEXT", nil, ____exports.default.unitUIContainer).current
    DzFrameSetAbsolutePoint(____exports.default.attackValueFrame, FRAMEPOINT_TOPLEFT, 0.35, 0.07)
    DzFrameSetFont(____exports.default.attackValueFrame, textFont, textHeight, 0)
    ____exports.default.armorValueFrame = __TS__New(Frame, "TEXT", nil, ____exports.default.unitArmorContainer).current
    DzFrameSetAbsolutePoint(____exports.default.armorValueFrame, FRAMEPOINT_TOPLEFT, 0.35, 0.036)
    DzFrameSetFont(____exports.default.armorValueFrame, textFont, textHeight, 0)
    ____exports.default.heroStrValueFrame = __TS__New(Frame, "TEXT", nil, ____exports.default.heroUIContainer).current
    DzFrameSetFont(____exports.default.heroStrValueFrame, textFont, textHeight, 0)
    DzFrameSetPoint(
        ____exports.default.heroStrValueFrame,
        FRAMEPOINT_TOPLEFT,
        NativeFrameUtil:getHeroStrLabel(),
        FRAMEPOINT_BOTTOMLEFT,
        0.005,
        0
    )
    ____exports.default.heroAgiValueFrame = __TS__New(Frame, "TEXT", nil, ____exports.default.heroUIContainer).current
    DzFrameSetPoint(
        ____exports.default.heroAgiValueFrame,
        FRAMEPOINT_TOPLEFT,
        NativeFrameUtil:getHeroAgiLabel(),
        FRAMEPOINT_BOTTOMLEFT,
        0.005,
        0
    )
    DzFrameSetFont(____exports.default.heroAgiValueFrame, textFont, textHeight, 0)
    ____exports.default.heroIntValueFrame = __TS__New(Frame, "TEXT", nil, ____exports.default.heroUIContainer).current
    DzFrameSetPoint(
        ____exports.default.heroIntValueFrame,
        FRAMEPOINT_TOPLEFT,
        NativeFrameUtil:getHeroIntLabel(),
        FRAMEPOINT_BOTTOMLEFT,
        0.005,
        0
    )
    DzFrameSetFont(____exports.default.heroIntValueFrame, textFont, textHeight, 0)
    ____exports.default.hpBackdropFrame = __TS__New(Frame, "BACKDROP", nil, ____exports.default.unitArmorContainer).current
    DzFrameSetTexture(____exports.default.hpBackdropFrame, "UI\\Glues\\SinglePlayer\\HumanCampaign3D\\Black32.blp", 0)
    DzFrameSetSize(____exports.default.hpBackdropFrame, 0.076, 0.012)
    DzFrameSetAbsolutePoint(____exports.default.hpBackdropFrame, FRAMEPOINT_CENTER, 0.254, 0.023)
    ____exports.default.manaBackdropFrame = __TS__New(Frame, "BACKDROP", nil, ____exports.default.unitArmorContainer).current
    DzFrameSetSize(____exports.default.manaBackdropFrame, 0.076, 0.012)
    DzFrameSetTexture(____exports.default.manaBackdropFrame, "UI\\Glues\\SinglePlayer\\HumanCampaign3D\\Black32.blp", 0)
    DzFrameSetAbsolutePoint(____exports.default.manaBackdropFrame, FRAMEPOINT_CENTER, 0.254, 0.009)
    ____exports.default.hpFrame = __TS__New(Frame, "TEXT", nil, ____exports.default.unitArmorContainer).current
    DzFrameSetFont(____exports.default.hpFrame, textFont, textHeight, 0)
    DzFrameSetAbsolutePoint(____exports.default.hpFrame, FRAMEPOINT_CENTER, 0.254, 0.023)
    ____exports.default.manaFrame = __TS__New(Frame, "TEXT", nil, ____exports.default.unitArmorContainer).current
    DzFrameSetAbsolutePoint(____exports.default.manaFrame, FRAMEPOINT_CENTER, 0.254, 0.009)
    DzFrameSetFont(____exports.default.manaFrame, textFont, textHeight, 0)
end
function BigAttributeUICompatibleState.prototype.moveNativeFrame(self)
    DzFrameClearAllPoints(NativeFrameUtil:getUnitAttackIcon(0))
    DzFrameSetPoint(
        NativeFrameUtil:getUnitAttackIcon(0),
        4,
        DzGetGameUI(),
        4,
        0,
        -0.5
    )
    DzFrameClearAllPoints(NativeFrameUtil:getUnitArmorIcon())
    DzFrameSetPoint(
        NativeFrameUtil:getUnitArmorIcon(),
        4,
        DzGetGameUI(),
        4,
        0,
        -0.5
    )
    DzFrameClearAllPoints(NativeFrameUtil:getGoldText())
    DzFrameSetPoint(
        NativeFrameUtil:getGoldText(),
        4,
        DzGetGameUI(),
        4,
        0,
        -0.5
    )
    DzFrameClearAllPoints(NativeFrameUtil:getLumberText())
    DzFrameSetPoint(
        NativeFrameUtil:getLumberText(),
        4,
        DzGetGameUI(),
        4,
        0,
        -0.5
    )
    DzFrameClearAllPoints(NativeFrameUtil:getUnitAttackValue(0))
    DzFrameSetPoint(
        NativeFrameUtil:getUnitAttackValue(0),
        4,
        DzGetGameUI(),
        4,
        0,
        -0.5
    )
    DzFrameClearAllPoints(NativeFrameUtil:getUnitArmorValue())
    DzFrameSetPoint(
        NativeFrameUtil:getUnitArmorValue(),
        4,
        DzGetGameUI(),
        4,
        0,
        -0.5
    )
    DzFrameClearAllPoints(NativeFrameUtil:getHeroStrValue())
    DzFrameSetPoint(
        NativeFrameUtil:getHeroStrValue(),
        4,
        DzGetGameUI(),
        4,
        0,
        -0.5
    )
    DzFrameClearAllPoints(NativeFrameUtil:getHeroAgiValue())
    DzFrameSetPoint(
        NativeFrameUtil:getHeroAgiValue(),
        4,
        DzGetGameUI(),
        4,
        0,
        -0.5
    )
    DzFrameClearAllPoints(NativeFrameUtil:getHeroIntValue())
    DzFrameSetPoint(
        NativeFrameUtil:getHeroIntValue(),
        4,
        DzGetGameUI(),
        4,
        0,
        -0.5
    )
    DzFrameClearAllPoints(NativeFrameUtil:getUnitAttackLabel(0))
    DzFrameSetAbsolutePoint(
        NativeFrameUtil:getUnitAttackLabel(0),
        FRAMEPOINT_TOPLEFT,
        0.34,
        0.08
    )
    DzFrameClearAllPoints(NativeFrameUtil:getUnitArmorLabel())
    DzFrameSetAbsolutePoint(
        NativeFrameUtil:getUnitArmorLabel(),
        FRAMEPOINT_TOPLEFT,
        0.34,
        0.048
    )
    DzFrameClearAllPoints(NativeFrameUtil:getHeroAgiLabel())
    DzFrameSetAbsolutePoint(
        NativeFrameUtil:getHeroAgiLabel(),
        FRAMEPOINT_TOPLEFT,
        0.44,
        0.06
    )
    DzFrameClearAllPoints(NativeFrameUtil:getHeroIntLabel())
    DzFrameSetAbsolutePoint(
        NativeFrameUtil:getHeroIntLabel(),
        FRAMEPOINT_TOPLEFT,
        0.44,
        0.04
    )
end
function BigAttributeUICompatibleState.showSolarUI(self, showAttackAndArmor, showHeroAtts)
    if showHeroAtts == nil then
        showHeroAtts = showAttackAndArmor
    end
    DzFrameShow(____exports.default.hpFrame, showAttackAndArmor)
    DzFrameShow(____exports.default.manaFrame, showAttackAndArmor)
    DzFrameShow(____exports.default.attackValueFrame, showAttackAndArmor)
    DzFrameShow(____exports.default.armorValueFrame, showAttackAndArmor)
    DzFrameShow(____exports.default.heroStrValueFrame, showHeroAtts)
    DzFrameShow(____exports.default.heroAgiValueFrame, showHeroAtts)
    DzFrameShow(____exports.default.heroIntValueFrame, showHeroAtts)
end
BigAttributeUICompatibleState.config = {isShowGreenAttack = false, isShowGreenArmor = false}
____exports.default = BigAttributeUICompatibleState
return ____exports
