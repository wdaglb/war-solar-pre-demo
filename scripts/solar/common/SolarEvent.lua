local ____lualib = require("lualib_bundle")
local __TS__New = ____lualib.__TS__New
local __TS__Class = ____lualib.__TS__Class
local __TS__SourceMapTraceBack = ____lualib.__TS__SourceMapTraceBack
__TS__SourceMapTraceBack(debug.getinfo(1).short_src, {["7"] = 2,["8"] = 2,["9"] = 3,["10"] = 3,["11"] = 4,["12"] = 4,["13"] = 5,["14"] = 5,["15"] = 6,["16"] = 6,["17"] = 7,["18"] = 7,["19"] = 8,["20"] = 8,["21"] = 9,["22"] = 9,["23"] = 10,["24"] = 10,["25"] = 12,["26"] = 13,["27"] = 19,["28"] = 19,["29"] = 19,["31"] = 19,["32"] = 24,["33"] = 24,["34"] = 24,["36"] = 25,["37"] = 26,["38"] = 26,["39"] = 26,["40"] = 27,["42"] = 28,["43"] = 28,["44"] = 29,["45"] = 29,["46"] = 29,["47"] = 29,["48"] = 29,["49"] = 29,["50"] = 28,["53"] = 31,["54"] = 31,["55"] = 31,["56"] = 32,["57"] = 31,["58"] = 31,["59"] = 34,["60"] = 26,["61"] = 26,["62"] = 36,["63"] = 36,["64"] = 36,["65"] = 37,["66"] = 37,["67"] = 37,["68"] = 37,["69"] = 36,["70"] = 36,["71"] = 24,["72"] = 44,["73"] = 45,["74"] = 46,["75"] = 46,["76"] = 46,["77"] = 47,["78"] = 48,["79"] = 49,["80"] = 49,["81"] = 49,["82"] = 50,["83"] = 49,["84"] = 49,["85"] = 52,["86"] = 46,["87"] = 46,["88"] = 54,["89"] = 54,["90"] = 54,["91"] = 55,["92"] = 55,["93"] = 55,["94"] = 55,["95"] = 55,["96"] = 54,["97"] = 54,["98"] = 44,["99"] = 59,["100"] = 60,["101"] = 61,["102"] = 61,["103"] = 61,["104"] = 62,["105"] = 63,["106"] = 64,["107"] = 64,["108"] = 64,["109"] = 65,["110"] = 64,["111"] = 64,["112"] = 67,["113"] = 61,["114"] = 61,["115"] = 69,["116"] = 69,["117"] = 69,["118"] = 70,["119"] = 69,["120"] = 69,["121"] = 59,["122"] = 77,["123"] = 77,["124"] = 77,["126"] = 79,["127"] = 80,["128"] = 80,["129"] = 80,["130"] = 81,["131"] = 82,["132"] = 84,["133"] = 85,["134"] = 86,["135"] = 86,["136"] = 86,["137"] = 87,["138"] = 86,["139"] = 86,["140"] = 89,["141"] = 80,["142"] = 80,["143"] = 91,["144"] = 91,["145"] = 91,["146"] = 92,["147"] = 91,["148"] = 91,["149"] = 77,["150"] = 100,["151"] = 101,["152"] = 101,["153"] = 101,["154"] = 102,["155"] = 102,["156"] = 102,["157"] = 102,["158"] = 102,["159"] = 101,["160"] = 101,["161"] = 100,["162"] = 110,["163"] = 111,["164"] = 111,["165"] = 111,["166"] = 112,["167"] = 111,["168"] = 111,["169"] = 110,["170"] = 121,["171"] = 122,["172"] = 122,["173"] = 122,["174"] = 123,["175"] = 123,["176"] = 123,["177"] = 123,["178"] = 123,["179"] = 122,["180"] = 122,["181"] = 121,["182"] = 131,["183"] = 132,["184"] = 132,["185"] = 132,["186"] = 133,["187"] = 132,["188"] = 132,["189"] = 131,["190"] = 141,["191"] = 142,["192"] = 142,["193"] = 142,["194"] = 143,["195"] = 143,["196"] = 143,["197"] = 143,["198"] = 143,["199"] = 142,["200"] = 142,["201"] = 141,["202"] = 151,["203"] = 152,["204"] = 152,["205"] = 152,["206"] = 153,["207"] = 152,["208"] = 152,["209"] = 151,["210"] = 161,["211"] = 162,["212"] = 162,["213"] = 162,["214"] = 163,["215"] = 162,["216"] = 162,["217"] = 161,["218"] = 171,["219"] = 172,["220"] = 172,["221"] = 172,["222"] = 173,["223"] = 172,["224"] = 172,["225"] = 171,["226"] = 181,["227"] = 182,["228"] = 182,["229"] = 182,["230"] = 183,["231"] = 183,["232"] = 183,["233"] = 183,["234"] = 182,["235"] = 182,["236"] = 181,["237"] = 187,["238"] = 188,["239"] = 188,["240"] = 188,["241"] = 189,["242"] = 188,["243"] = 188,["244"] = 187,["245"] = 197,["246"] = 198,["247"] = 198,["248"] = 198,["249"] = 199,["250"] = 199,["251"] = 199,["252"] = 199,["253"] = 198,["254"] = 198,["255"] = 197,["256"] = 207,["257"] = 208,["258"] = 207,["259"] = 215,["260"] = 216,["261"] = 216,["262"] = 216,["263"] = 217,["264"] = 217,["265"] = 217,["266"] = 217,["267"] = 216,["268"] = 216,["269"] = 215,["270"] = 226,["271"] = 227,["272"] = 226,["273"] = 234,["274"] = 235,["275"] = 235,["276"] = 235,["277"] = 236,["278"] = 236,["279"] = 236,["280"] = 236,["281"] = 235,["282"] = 235,["283"] = 234,["284"] = 240,["285"] = 241,["286"] = 241,["287"] = 241,["288"] = 242,["289"] = 241,["290"] = 241,["291"] = 240,["292"] = 250,["293"] = 251,["294"] = 251,["295"] = 251,["296"] = 252,["297"] = 252,["298"] = 252,["299"] = 252,["300"] = 251,["301"] = 251,["302"] = 250,["303"] = 256,["304"] = 257,["305"] = 257,["306"] = 257,["307"] = 258,["308"] = 257,["309"] = 257,["310"] = 256,["311"] = 265,["312"] = 267,["313"] = 268,["314"] = 268,["315"] = 268,["316"] = 270,["318"] = 271,["319"] = 271,["320"] = 272,["321"] = 272,["322"] = 272,["323"] = 272,["324"] = 272,["325"] = 272,["326"] = 271,["329"] = 274,["330"] = 274,["331"] = 274,["332"] = 275,["333"] = 274,["334"] = 274,["335"] = 277,["336"] = 268,["337"] = 268,["338"] = 279,["339"] = 279,["340"] = 279,["341"] = 280,["342"] = 279,["343"] = 279,["344"] = 265,["345"] = 287,["346"] = 288,["347"] = 289,["348"] = 289,["349"] = 289,["350"] = 291,["352"] = 292,["353"] = 292,["354"] = 293,["355"] = 293,["356"] = 293,["357"] = 293,["358"] = 293,["359"] = 293,["360"] = 292,["363"] = 295,["364"] = 295,["365"] = 295,["366"] = 296,["367"] = 297,["368"] = 298,["369"] = 299,["371"] = 295,["372"] = 295,["373"] = 302,["374"] = 289,["375"] = 289,["376"] = 304,["377"] = 305,["379"] = 307,["380"] = 307,["381"] = 307,["382"] = 308,["383"] = 307,["384"] = 307,["386"] = 287,["387"] = 320,["388"] = 321,["389"] = 320,["390"] = 329,["391"] = 330,["392"] = 329,["393"] = 336,["394"] = 337,["395"] = 338,["396"] = 336,["397"] = 19});
local ____exports = {}
local ____mitt = require("solar.lib.mitt")
local mitt = ____mitt.default
local ____Cache = require("solar.tool.Cache")
local Cache = ____Cache.default
local ____TriggerUtil = require("solar.util.system.TriggerUtil")
local TriggerUtil = ____TriggerUtil.default
local ____UnitSpellEvent = require("solar.tool.event.UnitSpellEvent")
local UnitSpellEvent = ____UnitSpellEvent.default
local ____UnitDeathEvent = require("solar.tool.event.UnitDeathEvent")
local UnitDeathEvent = ____UnitDeathEvent.default
local ____UnitAttackedEvent = require("solar.tool.event.UnitAttackedEvent")
local UnitAttackedEvent = ____UnitAttackedEvent.default
local ____UnitDamagedEvent = require("solar.tool.event.UnitDamagedEvent")
local UnitDamagedEvent = ____UnitDamagedEvent.default
local ____UnitEvent = require("solar.tool.event.UnitEvent")
local UnitEvent = ____UnitEvent.default
local ____UnitItemEvent = require("solar.tool.event.UnitItemEvent")
local UnitItemEvent = ____UnitItemEvent.default
local emitter = mitt()
local cache = __TS__New(Cache)
____exports.default = __TS__Class()
local SolarEvent = ____exports.default
SolarEvent.name = "SolarEvent"
function SolarEvent.prototype.____constructor(self)
end
function SolarEvent.prototype.playerChat(self, chatMessageToDetect, callback, exactMatchOnly)
    if exactMatchOnly == nil then
        exactMatchOnly = true
    end
    local key = (("playerChat:" .. chatMessageToDetect) .. ":") .. tostring(exactMatchOnly)
    cache:get(
        key,
        function()
            local trigger = CreateTrigger()
            do
                local i = 0
                while i < bj_MAX_PLAYER_SLOTS do
                    TriggerRegisterPlayerChatEvent(
                        trigger,
                        Player(i),
                        chatMessageToDetect,
                        exactMatchOnly
                    )
                    i = i + 1
                end
            end
            TriggerAddAction(
                trigger,
                function()
                    emitter:emit(key)
                end
            )
            return true
        end
    )
    emitter:on(
        key,
        function()
            callback(
                GetTriggerPlayer(),
                GetEventPlayerChatString()
            )
        end
    )
end
function SolarEvent.prototype.unitDamaged(self, callback)
    local key = "unitDamaged"
    cache:get(
        key,
        function()
            local trigger = CreateTrigger()
            TriggerUtil.SystemAnyUnitDamagedRegistTrigger(trigger)
            TriggerAddAction(
                trigger,
                function()
                    emitter:emit(key)
                end
            )
            return true
        end
    )
    emitter:on(
        key,
        function()
            callback(
                GetTriggerUnit(),
                GetEventDamageSource(),
                GetEventDamage()
            )
        end
    )
end
function SolarEvent.prototype.onUnitDamaged(self, callback)
    local key = "onUnitDamaged"
    cache:get(
        key,
        function()
            local trigger = CreateTrigger()
            TriggerUtil.SystemAnyUnitDamagedRegistTrigger(trigger)
            TriggerAddAction(
                trigger,
                function()
                    emitter:emit(key)
                end
            )
            return true
        end
    )
    emitter:on(
        key,
        function()
            callback(UnitDamagedEvent.instance)
        end
    )
end
function SolarEvent.prototype.enterRect(self, whichRect, callback)
    if whichRect == nil then
        whichRect = bj_mapInitialPlayableArea
    end
    local key = "enterRect:" .. tostring(GetHandleId(whichRect))
    cache:get(
        key,
        function()
            local rectRegion = CreateRegion()
            RegionAddRect(rectRegion, whichRect)
            local trigger = CreateTrigger()
            TriggerRegisterEnterRegion(trigger, rectRegion, nil)
            TriggerAddAction(
                trigger,
                function()
                    emitter:emit(key)
                end
            )
            return true
        end
    )
    emitter:on(
        key,
        function()
            callback(GetTriggerUnit())
        end
    )
end
function SolarEvent.prototype.unitPickupItem(self, callback)
    self:anyUnitEvent(
        EVENT_PLAYER_UNIT_PICKUP_ITEM,
        function(triggerUnit)
            callback(
                triggerUnit,
                GetManipulatedItem(),
                id2string(GetItemTypeId(GetManipulatedItem()))
            )
        end
    )
end
function SolarEvent.prototype.onUnitPickupItem(self, callback)
    self:anyUnitEvent(
        EVENT_PLAYER_UNIT_PICKUP_ITEM,
        function()
            callback(UnitItemEvent.instance)
        end
    )
end
function SolarEvent.prototype.unitDropItem(self, callback)
    self:anyUnitEvent(
        EVENT_PLAYER_UNIT_DROP_ITEM,
        function(triggerUnit)
            callback(
                triggerUnit,
                GetManipulatedItem(),
                id2string(GetItemTypeId(GetManipulatedItem()))
            )
        end
    )
end
function SolarEvent.prototype.onUnitDropItem(self, callback)
    self:anyUnitEvent(
        EVENT_PLAYER_UNIT_DROP_ITEM,
        function()
            callback(UnitItemEvent.instance)
        end
    )
end
function SolarEvent.prototype.unitUseItem(self, callback)
    self:anyUnitEvent(
        EVENT_PLAYER_UNIT_USE_ITEM,
        function(triggerUnit)
            callback(
                triggerUnit,
                GetManipulatedItem(),
                id2string(GetItemTypeId(GetManipulatedItem()))
            )
        end
    )
end
function SolarEvent.prototype.onUnitUseItem(self, callback)
    self:anyUnitEvent(
        EVENT_PLAYER_UNIT_USE_ITEM,
        function()
            callback(UnitItemEvent.instance)
        end
    )
end
function SolarEvent.prototype.unitConstructFinish(self, callback)
    self:anyUnitEvent(
        EVENT_PLAYER_UNIT_CONSTRUCT_FINISH,
        function(triggerUnit)
            callback(triggerUnit)
        end
    )
end
function SolarEvent.prototype.unitUpgradeFinish(self, callback)
    self:anyUnitEvent(
        EVENT_PLAYER_UNIT_UPGRADE_FINISH,
        function(triggerUnit)
            callback(triggerUnit)
        end
    )
end
function SolarEvent.prototype.unitSelected(self, callback)
    self:anyUnitEvent(
        EVENT_PLAYER_UNIT_SELECTED,
        function(triggerUnit)
            callback(
                triggerUnit,
                GetTriggerPlayer()
            )
        end
    )
end
function SolarEvent.prototype.onUnitSelected(self, callback)
    self:anyUnitEvent(
        EVENT_PLAYER_UNIT_SELECTED,
        function()
            callback(UnitEvent.instance)
        end
    )
end
function SolarEvent.prototype.unitSpellCast(self, callback)
    self:anyUnitEvent(
        EVENT_PLAYER_UNIT_SPELL_CAST,
        function(triggerUnit)
            callback(
                triggerUnit,
                id2string(GetSpellAbilityId())
            )
        end
    )
end
function SolarEvent.prototype.onUnitSpellCast(self, callback, abilityId)
    self:anyUnitSpellEvent(EVENT_PLAYER_UNIT_SPELL_CAST, callback, abilityId)
end
function SolarEvent.prototype.unitSpellEffect(self, callback)
    self:anyUnitEvent(
        EVENT_PLAYER_UNIT_SPELL_EFFECT,
        function(triggerUnit)
            callback(
                triggerUnit,
                id2string(GetSpellAbilityId())
            )
        end
    )
end
function SolarEvent.prototype.onUnitSpellEffect(self, callback, abilityId)
    self:anyUnitSpellEvent(EVENT_PLAYER_UNIT_SPELL_EFFECT, callback, abilityId)
end
function SolarEvent.prototype.unitDeath(self, callback)
    self:anyUnitEvent(
        EVENT_PLAYER_UNIT_DEATH,
        function(triggerUnit)
            callback(
                triggerUnit,
                GetKillingUnit()
            )
        end
    )
end
function SolarEvent.prototype.onUnitDeath(self, callback)
    self:anyUnitEvent(
        EVENT_PLAYER_UNIT_DEATH,
        function()
            callback(UnitDeathEvent.instance)
        end
    )
end
function SolarEvent.prototype.unitAttacked(self, callback)
    self:anyUnitEvent(
        EVENT_PLAYER_UNIT_ATTACKED,
        function(triggerUnit)
            callback(
                triggerUnit,
                GetAttacker()
            )
        end
    )
end
function SolarEvent.prototype.onUnitAttacked(self, callback)
    self:anyUnitEvent(
        EVENT_PLAYER_UNIT_ATTACKED,
        function()
            callback(UnitAttackedEvent.instance)
        end
    )
end
function SolarEvent.prototype.anyUnitEvent(self, whichPlayerUnitEvent, callback)
    local key = "anyUnitEvent:" .. tostring(GetHandleId(whichPlayerUnitEvent))
    cache:get(
        key,
        function()
            local trigger = CreateTrigger()
            do
                local i = 0
                while i < bj_MAX_PLAYER_SLOTS do
                    TriggerRegisterPlayerUnitEvent(
                        trigger,
                        Player(i),
                        whichPlayerUnitEvent,
                        nil
                    )
                    i = i + 1
                end
            end
            TriggerAddAction(
                trigger,
                function()
                    emitter:emit(key)
                end
            )
            return true
        end
    )
    emitter:on(
        key,
        function()
            callback(GetTriggerUnit())
        end
    )
end
function SolarEvent.prototype.anyUnitSpellEvent(self, whichPlayerUnitEvent, callback, spellAbilityId)
    local key = "anyUnitSpellEvent:" .. tostring(GetHandleId(whichPlayerUnitEvent))
    cache:get(
        key,
        function()
            local trigger = CreateTrigger()
            do
                local i = 0
                while i < bj_MAX_PLAYER_SLOTS do
                    TriggerRegisterPlayerUnitEvent(
                        trigger,
                        Player(i),
                        whichPlayerUnitEvent,
                        nil
                    )
                    i = i + 1
                end
            end
            TriggerAddAction(
                trigger,
                function()
                    emitter:emit(key)
                    local regCallback = cache:get((key .. ":") .. spellAbilityId)
                    if regCallback then
                        regCallback(UnitSpellEvent.instance)
                    end
                end
            )
            return true
        end
    )
    if spellAbilityId then
        cache:put((key .. ":") .. spellAbilityId, callback)
    else
        emitter:on(
            key,
            function()
                callback(UnitSpellEvent.instance)
            end
        )
    end
end
function SolarEvent.prototype.on(self, ____type, handler)
    emitter:on(____type, handler)
end
function SolarEvent.prototype.emit(self, ____type, data)
    emitter:emit(____type, data)
end
function SolarEvent.prototype.clear(self)
    cache:clear()
    emitter.all:clear()
end
____exports.default = SolarEvent
return ____exports
